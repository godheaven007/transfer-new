<template>
  <div class="order-wrap">
    <div class="order-info">
      <div class="order-info-item">
        <div><span class="title">累计充值</span>
          <el-tooltip class="item" effect="dark" content="只统计使用官方支付宝充值的金额" placement="top">
            <el-icon class="el-icon-question helpColor"></el-icon>
          </el-tooltip>
        </div>
        <div class="money"><b>257288.88</b>元</div>
      </div>
      <div class="order-info-item">
        <div><span class="title">累计转账</span>
          <el-tooltip class="item" effect="dark" content="只统计使用官方支付宝转账成功的金额" placement="top">
            <el-icon class="el-icon-question helpColor"></el-icon>
          </el-tooltip>
        </div>
        <div class="money"><b>257208.88</b>元</div>
      </div>
      <div class="order-info-item">
        <div><span class="title">邀请收益</span>
          <el-tooltip class="item" effect="dark" content="邀请好友返利的累计总金额" placement="top">
            <el-icon class="el-icon-question helpColor"></el-icon>
          </el-tooltip>
        </div>
        <div class="money"><b>0</b>元</div>
      </div>
      <div class="order-info-item deposit">
        <div><span class="title">账户余额</span></div>
        <div class="money"><b>80</b>元</div>
        <div class="deposit-wrap">
            <el-tooltip class="item" effect="dark" content="最低提现金额1元，提现到账时间为T+1" placement="left">
              <el-button class="deposit-btn cash" size="small" @click="handleCash">提现</el-button>
            </el-tooltip>
            <el-button class="deposit-btn record" size="small" @click="handleRecord">提现记录</el-button>
        </div>
      </div>
    </div>
    <div class="order-content-wrap">
      <div class="order-search">
        <el-form :inline="true">
          <el-form-item label="日期范围">
            <el-date-picker
                v-model="search.dateRange"
                type="daterange"
                range-separator="-"
                value-format="yyyy-MM-dd"
                start-placeholder="开始时间"
                end-placeholder="结束时间">
            </el-date-picker>
          </el-form-item>
          <el-form-item label="订单状态" class="ml10">
            <el-select v-model="search.status_text" placeholder="请选择" @change="doStatusChange">
              <el-option
                  v-for="item in search.statusList"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value">
              </el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="订单号" class="ml10">
            <el-input  placeholder="请输入订单号" v-model="search.order_number"></el-input>
          </el-form-item>
          <el-form-item class="ml20">
            <el-button type="primary" class="ml20 searchBtn" @click="doSearch()">搜索</el-button>
          </el-form-item>
        </el-form>
      </div>
      <div class="order-content">
        <el-table
            id="out-table"
            :header-cell-style="{textAlign: 'center'}"
            :cell-style="{ textAlign: 'center' }"
            :data="recordData">
          <el-table-column
              prop="create_time"
              label="转账时间">
          </el-table-column>
          <el-table-column
              prop="batch_order_number"
              label="订单编号">
          </el-table-column>
          <el-table-column
              prop="amount_sum"
              label="转账金额">
          </el-table-column>
          <el-table-column
              prop="charges"
              label="手续费">
          </el-table-column>
          <el-table-column
              prop="recharge"
              label="充值金额">
          </el-table-column>
          <el-table-column
              label="付款类型">
            <template slot-scope="scope">
              <span v-if="scope.row.type == 1">公用支付宝</span>
              <span v-else>微信</span>
            </template>
          </el-table-column>
          <el-table-column
              label="状态">
            <template slot-scope="scope">
              <el-tag :type="setTagType(scope.row.status)">{{ scope.row.status_text }}</el-tag>
            </template>
          </el-table-column>
          <el-table-column
              label="操作">
            <template slot-scope="scope">
              <!--等待审核-->
              <el-button size="mini" type="primary" @click="doDeposit">充值</el-button>
              <el-button size="mini" type="danger" @click="cancelDeposit(scope.row.id)">取消</el-button>
<!--              <div v-if="scope.row.status == 1">-->
<!--                <el-button size="mini" type="primary" @click="doDeposit">充值</el-button>-->
<!--                <el-button size="mini" type="danger" @click="cancelDeposit">取消</el-button>-->
<!--              </div>-->
<!--              <div v-else>-->
<!--                <el-button size="mini" type="primary" disabled>充值</el-button>-->
<!--                <el-button size="mini" type="danger" disabled>取消</el-button>-->
<!--              </div>-->
            </template>
          </el-table-column>
        </el-table>
        <div class="block">
          <el-pagination
              @size-change="handleSizeChange"
              @current-change="handleCurrentChange"
              :current-page="pagination.currentPage"
              :page-sizes="pagination.pageSizes"
              :page-size="pagination.pageSize"
              layout="total, sizes, prev, pager, next, jumper"
              :total="pagination.total"
              style="margin-top: 15px; text-align: right;"
          >
          </el-pagination>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import api from "@/util/api";
export default {
  name: "TransferOrder",
  data() {
    return {
      recordData: [],
      search: {
        type: 1,      // 转账类型1:支付宝,2:微信
        dateRange: [],
        status: '0',
        status_text: '全部',
        order_number: '',
        statusList: [
          {
            value: '0',
            label: '全部'
          },
          {
            value: '1',
            label: '等待审核'
          },
          {
            value: '2',
            label: '审核通过'
          },
          {
            value: '3',
            label: '订单取消'
          },
          {
            value: '4',
            label: '超时订单'
          }
        ]
      },
      pagination: {
        pageSizes: [10, 20, 50, 100],
        pageSize: 10,
        currentPage: 1,
        total: 0
      }
    }
  },
  methods: {
    handleCash() {
      alert('提现');
    },
    handleRecord() {
      alert('提现记录');
    },
    handleSizeChange(val) {
      this.pagination.pageSize = val;
      this.queryList();
    },
    handleCurrentChange(val) {
      this.pagination.currentPage = val;
      this.queryList();
    },
    doStatusChange(val) {
      this.search.status = val;
    },
    doSearch() {
      this.queryList();
    },
    queryList() {
      api.getBatchList({
        type: this.search.type,
        start_time: this.search.dateRange[0],
        end_time: this.search.dateRange[1],
        status: this.search.status,
        order_number: this.search.order_number,
        current_page: this.pagination.currentPage,
        per_page: this.pagination.pageSize
      }).then(res => {
        let result = res.data;
        this.pagination.total = result.total;
        this.recordData = result.data;
      })
    },
    // 充值
    doDeposit() {
      this.$confirm('是否确认充值？', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        // this.$message({
        //   type: 'success',
        //   message: '删除成功!'
        // });
        api.recharge({
          id: 1,
          type: 1
        })
        this.$pay({
          payAmount: 1,
          qrCodeUrl: 2
        });
      }).catch((error) => {
        this.$message({
          type: 'error',
          message: error
        });
      });
    },
    // 取消充值
    cancelDeposit(orderNo) {
      console.log(orderNo);
      this.$confirm('确认要取消？', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        api.cancelOrder({
          id: orderNo
        })
      }).catch(() => {
      });
    },
    setTagType(status) {
      if(status == '1') {
        // 1:等待审核
        return 'warning';
      } else if(status == '2') {
        // 2:审核通过
        return 'success';
      }
      // 3:订单取消,4:超时订单
      return 'danger';
    }
  },
  mounted() {
    this.queryList();
  }
}
</script>

<style scoped lang="scss">
@import "@/assets/scss/base.scss";
@import "@/assets/scss/mixin.scss";
  .order-wrap {
    padding: 20px;
    .order-info {
      display: flex;
      padding: 20px 0;
      border: 1px solid #ebeef5;
      border-radius: 4px;
      .order-info-item {
        flex: 1;
        display: flex;
        position: relative;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 80px;
        border-right: 1px solid #ebeef5;
        .title{
          font-size: 14px;
          color: #909399;
        }
        .money {
          margin-top: 10px;
          b{font-size: 24px;}
        }
        .deposit-wrap {
          position: absolute;
          right: 0;
          top: 50%;
          transform: translateY(-50%);
          width: 100px;
          text-align: center;
          .deposit-btn {
            color: #fff;
            &.cash {
              @include baseBtn;
            }
            &.record {
              @include resetBtn;
              margin-top: 10px;
            }
          }
        }
      }
    }
    .order-content-wrap {
      padding: 20px;
      margin-top: 20px;
      border: 1px solid #ebeef5;
      .order-search {
        padding-left: 50px;
      }
    }
  }
  .searchBtn{
    @include baseBtn;
  }
</style>